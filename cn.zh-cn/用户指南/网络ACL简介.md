# 网络ACL简介<a name="acl_0001"></a>

网络ACL是一个子网级别的可选安全层，通过与子网关联的出方向/入方向规则控制出入子网的数据流。

如[图1](#fig10469151512467)所示。

**图 1**  安全组与网络ACL<a name="fig10469151512467"></a>  
![](figures/安全组与网络ACL.png "安全组与网络ACL")

网络ACL与安全组类似，都是安全防护策略，当您想增加额外的安全防护层时，就可以启用网络ACL。安全组只有“允许”策略，但网络ACL可以“拒绝”和“允许”，两者结合起来，可以实现更精细、更复杂的安全访问控制。

网络ACL与安全组的详细区别请参见[安全组与网络ACL区别](安全组与网络ACL区别.md)。

## 网络ACL基本信息<a name="section1952742625114"></a>

-   您的VPC默认没有网络ACL。当您需要时，可以创建自定义的网络ACL并将其与子网关联。关联子网后，网络ACL默认拒绝所有出入子网的流量，直至添加放通规则。
-   网络ACL可以关联多个子网，但一个子网同一时间只能关联一个网络ACL。
-   每个新创建的网络ACL最初都为未激活状态，直至您关联子网为止。
-   网络ACL是有状态的。如果您发送一个出站请求，且该网络ACL的出站规则是放通的话，那么无论其入站规则如何，都将允许该出站请求的响应流量流入。同理，如果您发送一个入站请求，且该网络ACL的入站规则是放通的，那无论出站规则如何，都将允许该入站请求的响应流量可以出站。

    不同协议的连接跟踪老化时间不同，已建立连接状态的TCP协议连接老化时间是600s，ICMP协议老化时间是30s。对于其他协议，如果两个方向都收到了报文，连接老化时间是180s，如果只是单方向收到了一个或多个包，另一个方向没有收到包时，老化时间是30s。对于除 TCP、UDP 或 ICMP 以外的协议，仅跟踪 IP 地址和协议编号。


## 网络ACL默认规则<a name="section99541345213"></a>

每个网络ACL都包含一组默认规则，如下所示：

-   默认放通同一子网内的流量。
-   默认放通目的IP地址为255.255.255.255/32的广播报文。用于配置主机的启动信息。
-   默认放通目的网段为224.0.0.0/24的组播报文。供路由协议使用。
-   默认放通目的IP地址为169.254.169.254/32，TCP端口为80的metadata报文。用于获取元数据。
-   默认放通公共服务预留网段资源的报文，例如目的网段为100.125.0.0/16的报文。
-   除上述默认放通的流量外，其余出入子网的流量全部拒绝，如[表1](#table1034601475112)所示。该规则不能修改和删除。

    **表 1**  网络ACL默认规则

    <a name="table1034601475112"></a>
    <table><thead align="left"><tr id="row1267171445118"><th class="cellrowborder" valign="top" width="11.918808119188078%" id="mcps1.2.8.1.1"><p id="p4671214185116"><a name="p4671214185116"></a><a name="p4671214185116"></a>方向</p>
    </th>
    <th class="cellrowborder" valign="top" width="6.05939406059394%" id="mcps1.2.8.1.2"><p id="p46711614195111"><a name="p46711614195111"></a><a name="p46711614195111"></a>优先级</p>
    </th>
    <th class="cellrowborder" valign="top" width="7.0892910708929096%" id="mcps1.2.8.1.3"><p id="p186711114105115"><a name="p186711114105115"></a><a name="p186711114105115"></a>动作</p>
    </th>
    <th class="cellrowborder" valign="top" width="8.25917408259174%" id="mcps1.2.8.1.4"><p id="p86711114195114"><a name="p86711114195114"></a><a name="p86711114195114"></a>协议</p>
    </th>
    <th class="cellrowborder" valign="top" width="14.198580141985797%" id="mcps1.2.8.1.5"><p id="p12671101405114"><a name="p12671101405114"></a><a name="p12671101405114"></a>源地址</p>
    </th>
    <th class="cellrowborder" valign="top" width="12.568743125687428%" id="mcps1.2.8.1.6"><p id="p2671814165117"><a name="p2671814165117"></a><a name="p2671814165117"></a>目的地址</p>
    </th>
    <th class="cellrowborder" valign="top" width="39.90600939906009%" id="mcps1.2.8.1.7"><p id="p136711114195118"><a name="p136711114195118"></a><a name="p136711114195118"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row167117147516"><td class="cellrowborder" valign="top" width="11.918808119188078%" headers="mcps1.2.8.1.1 "><p id="p14671214175113"><a name="p14671214175113"></a><a name="p14671214175113"></a>入方向</p>
    </td>
    <td class="cellrowborder" valign="top" width="6.05939406059394%" headers="mcps1.2.8.1.2 "><p id="p467181413516"><a name="p467181413516"></a><a name="p467181413516"></a>*</p>
    </td>
    <td class="cellrowborder" valign="top" width="7.0892910708929096%" headers="mcps1.2.8.1.3 "><p id="p767141475110"><a name="p767141475110"></a><a name="p767141475110"></a>拒绝</p>
    </td>
    <td class="cellrowborder" valign="top" width="8.25917408259174%" headers="mcps1.2.8.1.4 "><p id="p12671161413512"><a name="p12671161413512"></a><a name="p12671161413512"></a>全部</p>
    </td>
    <td class="cellrowborder" valign="top" width="14.198580141985797%" headers="mcps1.2.8.1.5 "><p id="p1967117148511"><a name="p1967117148511"></a><a name="p1967117148511"></a>0.0.0.0/0</p>
    </td>
    <td class="cellrowborder" valign="top" width="12.568743125687428%" headers="mcps1.2.8.1.6 "><p id="p10671101425118"><a name="p10671101425118"></a><a name="p10671101425118"></a>0.0.0.0/0</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.90600939906009%" headers="mcps1.2.8.1.7 "><p id="p967101418517"><a name="p967101418517"></a><a name="p967101418517"></a>拒绝所有入站流量</p>
    </td>
    </tr>
    <tr id="row11671414155113"><td class="cellrowborder" valign="top" width="11.918808119188078%" headers="mcps1.2.8.1.1 "><p id="p1567121445119"><a name="p1567121445119"></a><a name="p1567121445119"></a>出方向</p>
    </td>
    <td class="cellrowborder" valign="top" width="6.05939406059394%" headers="mcps1.2.8.1.2 "><p id="p2671161475110"><a name="p2671161475110"></a><a name="p2671161475110"></a>*</p>
    </td>
    <td class="cellrowborder" valign="top" width="7.0892910708929096%" headers="mcps1.2.8.1.3 "><p id="p18671181425114"><a name="p18671181425114"></a><a name="p18671181425114"></a>拒绝</p>
    </td>
    <td class="cellrowborder" valign="top" width="8.25917408259174%" headers="mcps1.2.8.1.4 "><p id="p667111455114"><a name="p667111455114"></a><a name="p667111455114"></a>全部</p>
    </td>
    <td class="cellrowborder" valign="top" width="14.198580141985797%" headers="mcps1.2.8.1.5 "><p id="p3671114195119"><a name="p3671114195119"></a><a name="p3671114195119"></a>0.0.0.0/0</p>
    </td>
    <td class="cellrowborder" valign="top" width="12.568743125687428%" headers="mcps1.2.8.1.6 "><p id="p06711814205118"><a name="p06711814205118"></a><a name="p06711814205118"></a>0.0.0.0/0</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.90600939906009%" headers="mcps1.2.8.1.7 "><p id="p17671814105114"><a name="p17671814105114"></a><a name="p17671814105114"></a>拒绝所有出站流量</p>
    </td>
    </tr>
    </tbody>
    </table>


## 规则优先级<a name="section74125695419"></a>

-   网络ACL规则的优先级使用“优先级”值来表示，优先级的值越小，优先级越高，最先应用。优先级的值为“\*”的是默认规则，优先级最低。
-   多个网络ACL规则冲突，优先级高的规则生效，优先级低的不生效。若某个规则需要优先或落后生效，可在对应规则（需要优先或落后于某个规则生效的规则）前面或后面插入此规则。

## 应用场景<a name="section1864416226298"></a>

-   由于应用层需要对外提供服务，因此入方向规则必须放通所有地址，如何防止恶意用户的非正常访问呢？

    解决方案：通过网络ACL添加拒绝规则，拒绝恶意IP的访问。

-   隔离具有漏洞的应用端口，比如Wanna Cry，关闭445端口

    解决方案：通过网络ACL添加拒绝规则，拒绝恶意协议和端口，比如TCP：445端口。

-   子网内的通信无防护诉求，仅有子网间的访问限制。

    解决方案：通过网络ACL设置子网间的访问规则

-   对访问频繁的应用，调整安全规则顺序，提高性能。

    解决方案：网络ACL支持规则编排，可以把访问频繁的规则置顶。


## 网络ACL配置流程<a name="section14396131910515"></a>

子网配置网络ACL的流程，如[图2](#fig91216511166)所示。

**图 2**  网络ACL配置流程<a name="fig91216511166"></a>  
![](figures/网络ACL配置流程.png "网络ACL配置流程")

1.  参考[创建网络ACL](创建网络ACL.md)创建网络ACL。
2.  参考[添加网络ACL规则](添加网络ACL规则.md)添加网络ACL规则。
3.  参考[将子网和网络ACL关联](将子网和网络ACL关联.md)将子网与网络ACL关联。子网关联后，网络ACL将自动开启并生效。

