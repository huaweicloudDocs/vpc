# IPv4/IPv6双栈网络<a name="vpc_0002"></a>

## 简介<a name="section31519520369"></a>

IPv4/IPv6双栈可为您的实例（例如：ECS）提供两个不同版本的IP地址：IPv4地址和IPv6地址，这两个IP地址都可以进行内网/公网访问。

-   通过IPv4私网地址在ECS之间进行内网访问。
-   通过IPv4私网地址绑定弹性公网IP的方式访问互联网。
-   通过IPv6地址在双栈ECS之间进行内网访问（同VPC）。
-   通过IPv6地址与互联网上的IPv6网络进行访问。

## 应用场景<a name="section182413208373"></a>

如果您的应用需要为使用IPv6终端的用户提供访问服务，则您可使用：IPv6弹性公网IP或IPv6双栈。

如果您的应用既需要为使用IPv6终端的用户提供访问服务，又需要对这些访问来源进行数据分析处理，则您必须使用IPv6双栈。

如果您的应用系统与其他系统（例如：数据库系统）、应用系统之间需要使用IPv6进行内网访问，则您必须使用IPv6双栈。

## 基本操作<a name="section194330165219"></a>

>![](public_sys-resources/icon-note.gif) **说明：** 
>-   IPv4/IPv6双栈网络的基本操作与之前的IPv4网络相同。只有部分页面的配置参数会略有差异，具体请以管理控制台显示为准。
>-   IPv6双栈，当前暂不收费，后续定价会根据运营商收费策略的变化进行调整。
>-   只有选择如下类型的ECS才能体验IPv6双栈，请务必选择支持的区域和规格。
>    -   “华北-北京四”区域的“可用区1”下，选择s6、c6规格。
>    -   “华北-北京四”区域的“可用区2”下，选择s6、c6规格。
>    -   “华北-北京四”区域的“可用区7”下，选择s6、c6规格。
>    -   “华东-上海一”区域的“可用区1”下，选择s6、c6s、c6、m6、c3、m3规格。
>    -   “华东-上海一”区域的“可用区2”下，选择s6、c6、c6s、m6、c3规格。
>    -   “华东-上海一”区域的“可用区3”下，选择s6、c6s、c6、m6规格。
>    -   “西南-贵阳一”区域的“可用区1”下，选择s6、c6s、c6、m6规格。
>    -   “华南-广州”区域的“可用区2”下，选择s6、c6规格。
>    -   “华南-广州”区域的“可用区3”下，选择s6、c6规格。
>    -   “华南-广州”区域的“可用区5”下，选择s6、c6规格。
>    -   “华南-广州”区域的“可用区6”下，选择s6、c6规格。
>    -   “亚太-曼谷”区域的“可用区1”下，选择c6规格。
>    -   “亚太-曼谷”区域的“可用区2”下，选择c6规格。
>    -   “亚太-新加坡”区域的“可用区1”下，选择s6、c6s、c6规格。
>    -   “亚太-新加坡”区域的“可用区2”下，选择c6s、c6规格。
>    -   “拉美-圣保罗一”区域的“可用区1”下，选择s6、c6s、c6规格。
>    -   “拉美-圣保罗一”区域的“可用区2”下，选择s6、c6s、c6规格。
>    -   “中国-香港”区域的“可用区1”下，选择c6规格。
>    -   “中国-香港”区域的“可用区2”下，选择c6规格。

**创建IPv6子网**

参考[为虚拟私有云创建新的子网](为虚拟私有云创建新的子网.md)创建子网，勾选“开启IPv6”，将自动为子网分配IPv6网段。该功能一旦开启，将不能关闭。暂不支持自定义设置IPv6网段。

**图 1**  创建IPv6子网<a name="fig8113192217189"></a>  
![](figures/创建IPv6子网.png "创建IPv6子网")

**查看已使用IPv6地址**

在子网列表中单击子网名称，在“已用IP地址”页签可以查看已经使用的IPv4地址和IPv6地址。

**添加IPv6安全组规则**

参考[添加安全组规则](添加安全组规则.md)添加安全组规则，类型选择“IPv6”，源地址或目的地址填写IPv6地址。

**图 2**  添加IPv6安全组规则<a name="fig10442193883817"></a>  
![](figures/添加IPv6安全组规则.png "添加IPv6安全组规则")

**添加IPv6网络ACL规则**

参考[添加网络ACL规则](添加网络ACL规则.md)添加网络ACL规则，类型选择“IPv6”，源地址或目的地址填写IPv6地址。

**图 3**  添加IPv6网络ACL规则<a name="fig374494352712"></a>  
![](figures/添加IPv6网络ACL规则.png "添加IPv6网络ACL规则")

**购买IPv6弹性公网IP**

您可以购买IPv6弹性公网IP ，或者将已有IPv4弹性公网IP转换为IPv6弹性公网IP，详情请参见[IPv6弹性公网IP](IPv6弹性公网IP.md)。

**添加IPv6弹性公网IP/IPv6双栈网卡到共享带宽**

参考[添加弹性公网IP到共享带宽](添加弹性公网IP到共享带宽.md)将IPv6弹性公网IP、IPv6双栈网卡添加到共享带宽。

**图 4**  添加IPv6双栈网卡到共享带宽<a name="fig4569191243013"></a>  
![](figures/添加IPv6双栈网卡到共享带宽.png "添加IPv6双栈网卡到共享带宽")

**添加IPv6自定义路由**

参考[添加自定义路由](添加自定义路由.md)添加自定义路由，其中目的地址和下一跳地址可以配置IPv4网段或IPv6网段。如果目的地址是IPv6网段，则下一跳地址暂时只能使用同一VPC内的地址。

>![](public_sys-resources/icon-note.gif) **说明：** 
>路由的目的地址为IPv6网段时，对应下一跳类型仅支持ECS实例、扩展网卡、 虚拟IP，同时下一跳资源具备IPv6地址。

**图 5**  添加路由<a name="fig1737433545914"></a>  
![](figures/添加路由.png "添加路由")

**申请IPv6虚拟IP地址**

参考[申请虚拟IP地址](申请虚拟IP地址.md)申请虚拟IP地址，其中IP类型可以选择“IPv4”或“IPv6”。

当前该功能仅在“华东-上海一”支持。

**图 6**  申请虚拟IP地址<a name="fig4553311304"></a>  
![](figures/申请虚拟IP地址.png "申请虚拟IP地址")

>![](public_sys-resources/icon-note.gif) **说明：** 
>IPv6的虚拟IP仅支持绑定一个网卡（双栈网卡），如需进行服务器的主备切换，请通过调用API方式。具体请参考[配置云服务器高可用的IPv6虚拟IP功能](https://support.huaweicloud.com/api-vpc/vpc_apieg_0006.html)。

**动态获取IPv6地址**

购买的IPv6双栈ECS实例后，您可以在ECS详情页查看自动分配的IPv6地址，也可以登录到ECS，通过**ifconfig**查看分配的IPv6地址。

如果自动分配IPv6地址失败，或者您选的其他镜像不支持自动分配IPv6地址，请参考“[动态获取IPv6地址](https://support.huaweicloud.com/usermanual-ecs/ecs_03_0508.html)”，手动获取IPv6地址。

>![](public_sys-resources/icon-note.gif) **说明：** 
>如果云服务器使用的是公共镜像，则支持情况如下：
>-   Windows公共镜像默认已开启IPv6动态获取功能，无需配置。
>-   Linux公共镜像开启动态获取IPv6功能时，需要先判断是否支持IPv6协议栈，再判断是否已开启动态获取IPv6。目前，所有Linux公共镜像均已支持IPv6协议栈，并且Ubuntu 16操作系统已默认开启动态获取IPv6。即Ubuntu 16操作系统无需配置，其他Linux公共镜像需要执行开启动态获取IPv6的操作。

